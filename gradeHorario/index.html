<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grade de Horários</title>
</head>
<body>
    <section id="grade-container">
        <table border="1" id="grade">
            <thead>
                <tr id="grade-cabecalho">
                    
                </tr>
            </thead>
            <tbody id="grade-corpo">
                
            </tbody>
        </table>
    </section>
    <script>
        var dias = [
            'Segunda',
            'Terça',
            'Quarta',
            'Quinta',
            'Sexta',
        ];
        var horarios = [
            '08:00',
            '09:00',
            '10:00',
            '11:00',
            '12:00',
            '13:00',
            '14:00',
            '15:00',
            '16:00',
            '17:00',
        ];
        var grade = {};
        var horariosMarcados = [
            {
                titulo: 'Arroto bom',
                horarios: [
                    {dia: 'Segunda', horarios:['08:00','09:00']},
                    {dia: 'Segunda', horarios:['11:00','12:00']},
                    {dia: 'Sexta', horarios:['11:00','12:00']}
                ]
            },
            {
                titulo: 'Arroto ruim',
                horarios: [
                    {dia: 'Segunda', horarios:['14:00','15:00']},
                    {dia: 'Quinta', horarios:['11:00','12:00']}
                ]
            }
    ];
        var gradeFront = document.getElementById('grade');
        var cabecalhoFront = document.getElementById('grade-cabecalho')
        var corpoFront = document.getElementById('grade-corpo');
    
        class HorarioMarcado {
            constructor(titulo, horarios){
                this.titulo = titulo;
                this.horarios = horarios;
            }
        }
        class Horarios {
            constructor(dia, horarios){
                this.dia = dia;
                this.horarios = horarios;
            }
        }
        // inicio
        document.addEventListener('DOMContentLoaded', function () {
            iniciarVariavelGrade(dias, horarios);
            console.log(grade);
            
            horariosMarcados.forEach((horarioMarcado) => {
                adicionarHorarioGrade(horarioMarcado);
            });
            
            construirGradeFront(dias, horarios);
        });

        // Constroi a grade no frontEnd
        function construirGradeFront(dias, horarios){
            // inicio de cabecalho com 1 coluna vazia
            var cabecalhoConstrutor = '<th class="grade-titulo"></th>\n';
            var corpoConstrutor = '';

            // cria os titulos do cabecalho
            dias.forEach((dia) => {
                cabecalhoConstrutor += `<th class="grade-titulo">${dia}</th>\n`;
            });

            // cria cada celula da tabela seguindo a direção de linha
            horarios.forEach((horario) => {
                // coluna referente ao titulo de horario
                var linhaConstrutor = `<th scope="row" class="grade-titulo-row">${horario}</th>`;

                // uma celula para cada dia nesse horario
                dias.forEach((dia) => {

                    /**
                     * Se a celula é vazia para esse horario e esse dia
                     * ou se não é um horario de marcação
                     * senão não é criado a celula para dá espaço a celulas de maior espaço
                    **/
                    if(!grade[dia][horario]) {
                        linhaConstrutor += '<td class="grade-celula">\n<div class="espaco-vazio-grade">-</div>\n</td>\n';
                    }else if(!grade[dia][horario].marcado) {
                        linhaConstrutor += `<td class="grade-celula">${grade[dia][horario].titulo}</td>\n`
                    }
                });
                // adiciona a coluna de um horario
                corpoConstrutor += `<tr>${linhaConstrutor}</tr>\n`
            });

            cabecalhoFront.innerHTML = cabecalhoConstrutor;
            corpoFront.innerHTML = corpoConstrutor; 
        }
        
        // cria a grade de horarios base a partir dos dias e horarios escolhidos
        function iniciarVariavelGrade(dias, horarios) {
            dias.forEach(dia => {
                grade[dia] = {};

                horarios.forEach(horario => {
                    grade[dia][horario] = null;
                });
            });
        }
    
        // adiciona um horarioMarcado na grade de horarios
        function adicionarHorarioGrade(horarioMarcado) {
            // horarios: [{dia:'', horarios: []}]
            horarioMarcado.horarios.forEach(horario => {
                var inicial = null;
                // horarios: []
                horario.horarios.forEach((horarioDia) => {

                    // a primeira celula ocupara o espaço dos horarios subsequentes
                    grade[horario.dia][horarioDia] = inicial ? {titulo: horarioMarcado.titulo, marcado: true} : {titulo: horarioMarcado.titulo, marcado: false};
                });
            });
        }
    
        // remove um horarioMarcado na grade de horarios
        function removerHorarioGrade(horarioMarcado) {
            // horarios de um dia
            grade.map((horariosDia) => {
                // um horario
                horariosDia.map((horario) => {
                    
                    // se o titulo do horarioMarcado na celula é igual ao escolhido para remoção
                    if(
                        horario.titulo == horarioMarcado.titulo
                    ) {
                        horario = null;
                    }
                });
            });
        }
        
    </script>
</body>
</html>
